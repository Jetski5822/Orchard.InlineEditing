@using Orchard.ContentManagement
@using Orchard.Environment.Descriptor.Models
@using Orchard.InlineEditing
@using Orchard.Core.Common.Models
@using Orchard.Core.Common.Settings
@using Orchard.Core.Common.ViewModels

@{
    var part = (BodyPart)Model.DisplayShape.ContentPart;
    var typePartSettings = part.Settings.GetModel<BodyTypePartSettings>();

    var flavor = (typePartSettings != null && !string.IsNullOrWhiteSpace(typePartSettings.Flavor))
                       ? typePartSettings.Flavor
                       : part.PartDefinition.Settings.GetModel<BodyPartSettings>().FlavorDefault;

    BodyEditorViewModel viewModel = new BodyEditorViewModel {
        BodyPart = part,
        EditorFlavor = flavor,
        AddMediaPath = "/"
    };
    
    var shellDescriptor = WorkContext.Resolve<ShellDescriptor>();

    if (flavor == "html") {
        if (shellDescriptor.Features.Any(x => x.Name == "TinyMce")) {
            Script.Require("TinyMce");
            Script.Include("orchard-inlineedit-tinymceeditor.js");
        }
    }
    if (flavor == "markdown") {
        if (shellDescriptor.Features.Any(x => x.Name == "Markdown")) {
            Script.Require("OrchardMarkdown");
            Script.Include("orchard-inlineedit-markdowneditor.js");
        }
    }
}

@using (Html.InlineEdit(this)) {
    @Display.Body_Editor(viewModel)
}